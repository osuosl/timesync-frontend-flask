{% extends "layout.html" %}

{% block title %} View Times {% endblock %}

{% block scripts %}
<script type="text/javascript" src="{{ url_for('static', filename='scripts/table_sort.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='scripts/clear_form.js') }}"></script>

<script>
window.onload = function()
{
    // Make the table sortable and sort it by most recent
    var timesTable = document.body.getElementsByTagName("table")[0];
    makeSortable(timesTable);
    sortTable(timesTable, 3, -1);
}
</script>
{% endblock %}

{% block body %}
    <div class="filter-params">
        <form method="POST">
            {{ form.csrf_token }}
            <p>{{ form.user.label }} {{ form.user }}</p>
            <p>{{ form.project.label }} {{ form.project }} {{ form.project.description }}</p>
            <p>{{ form.activity.label }} {{ form.activity }} {{ form.activity.description}} </p>
            <p>{{ form.start.label }} {{ form.start }} {{ form.start.description }}</p>
            <p>{{ form.end.label }} {{ form.end }} {{ form.end.description }}</p>
            <p><input type="submit" value="Submit">  <input type="button" name="clear" value="Clear" onclick="clearForm(this.form, false);"></p>
        </form>
    </div>

    <div class="times-summary">
        <table>
            <tr>
                <th>Total Time</th>
            </tr>
            <tr>
                <th>Unique Users</th>
            </tr>
            <tr>
                <th>Users List</th>
            </tr>
            <tr>
                <th>Unique Projects</th>
            </tr>
            <tr>
                <th>Projects List</th>
            </tr>
            <tr>
                <th>Unique Activities</th>
            </tr>
            <tr>
                <th>Activities List</th>
            <tr>
        </table>
    </div>

    <div class="view-times">
        <table>
            <thead>
                <tr>
                    <th></th>
                    <th></th>
                    <th class="alpha">User</th>
                    <th class="hms">Duration</th>
                    <th class="date">Date Worked</th>
                    <th class="list">Projects</th>
                    <th class="list">Activities</th>
                    <th>Issue URI</th>
                    <th>Additional Notes</th>
                </tr>
            </thead>

            <tbody>
                {% for t in times %}
                <tr>
                    {% if t['user'] == user or is_admin %}
                        <td><a href="{{ url_for('delete_time', time=t['uuid']) }}">DELETE</a></td>
                        <td><a href="{{ url_for('edit_time', time=t['uuid']) }}">EDIT</a></td>
                    {% else %}
                        <td></td>
                        <td></td>
                    {% endif %}

                    <td>{{ t['user'] }}</td>
                    <td>{{ t['duration'] | hms_filter }}</td>
                    <td>{{ t['date_worked'] }}</td>
                    <td>{{ t['project'] | join(' ') }}</td>
                    <td>{{ t['activities'] | join(' ') }}</td>
                    <td>{{ t['issue_uri'] }}</td>
                    <td>{{ t['notes'] }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endblock %}
