{% extends "layout.html" %}

{% block title %} View Projects {% endblock %}

{% block imports %}
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='lib/simplePagination/simplePagination.css') }}">
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/view_object.css') }}">

<script type="text/javascript" src="{{ url_for('static', filename='lib/jquery-3.1.0.min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='lib/simplePagination/jquery.simplePagination.js') }}"></script>
{% endblock %}

{% block scripts %}
<script type="text/javascript" src="{{ url_for('static', filename='scripts/table_sort.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='scripts/clear_form.js') }}"></script>

<script>
$(document).ready(function() {
    var tableSelector = "#view-projects table";
    var perPage = 10;

    addPagination(tableSelector, perPage);
    makeSortable(tableSelector, perPage, 0, "asc");
});
</script>
{% endblock %}

{% block body %}
    {% if user['site_admin'] or user['site_manager'] %}
        <div class="create-link">
            <a href="{{ url_for('create_project') }}">Create Project</a>
        </div>
    {% endif %}

    <div class="filter-params">
        <form method="POST">
            {{ form.csrf_token }}
            <p>{{ form.username.label }} {{ form.username }}</p>
            <p>{{ form.slug.label }} {{ form.slug }}</p>
            <p>{{ form.include_deleted.label }} {{ form.include_deleted }}</p>
            <p>{{ form.include_revisions.label }} {{ form.include_revisions }}</p>
            <p><input type="submit" value="Submit">  <input type="button" name="clear" value="Clear" onclick="clearForm(this.form, true);"></p>
        </form>
    </div>

    <div id="paginator"></div>

    <div id="view-projects">
        <table>
            <thead>
                <tr>
                    <th class="alpha">Name</th>
                    <th class="alpha">Default Activity</th>
                    <th class="list">Slugs</th>
                    <th class="list">Members</th>
                    <th class="list">Managers</th>
                    <th class="list">Spectators</th>
                    <th>URI</th>
                </tr>
            </thead>

            {% for p in projects %}
            <tr>
                <td>{{ p['name'] }}</td>
                <td>{{ p['default_activity'] }}</td>
                <td>{{ p['slugs'] | join(' ') }}</td>
                <td>{{ p['members'] | join(' ') }}</td>
                <td>{{ p['managers'] | join(' ') }}</td>
                <td>{{ p['spectators'] | join(' ') }}</td>
                <td>{{ p['uri'] }}</td>
                {% if is_admin %}
                    <td><a href="{{ url_for('edit_project', project=p['slugs'][0]) }}">EDIT</a></td>
                {% else %}
                    {% for manager in p['managers'] %}
                        {% if manager == user['username'] or admin %}
                            <td><a href="{{ url_for('edit_project', project=p['slugs'][0]) }}">EDIT</a></td>
                        {% endif %}
                    {% endfor %}
                {% endif %}
            </tr>
            {% endfor %}
        </table>
    </div>
{% endblock %}
